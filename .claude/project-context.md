# ğŸ² DigiPoly ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä»•æ§˜æ›¸

## ğŸ“Œ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**ã‚¢ãƒ—ãƒªå**: DigiPoly
**ç›®çš„**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã®ãƒ¢ãƒãƒãƒªãƒ¼ã‚’ã‚¹ãƒãƒ›ã§è£œåŠ©çš„ã«ãƒ—ãƒ¬ã‚¤ã™ã‚‹ã‚¢ãƒ—ãƒª
**æ ¸ã¨ãªã‚‹ä½“é¨“**: é¢å€’ãªç´™å¹£ã®ã‚„ã‚Šå–ã‚Šã‚’ã‚¹ãƒãƒ›ã§å®Œçµã•ã›ã€å…¨å“¡ãŒå¸¸ã«æ­£ç¢ºãªæ®‹é«˜ã‚’ç¢ºèªã§ãã‚‹

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| åŒºåˆ† | ä½¿ç”¨æŠ€è¡“ | å½¹å‰² |
|------|----------|------|
| **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰** | Vite + React + TypeScript + TailwindCSS + DaisyUI | UIãƒ»æ“ä½œç”»é¢ |
| **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰** | Ruby on Rails (API mode) | APIãƒ»çŠ¶æ…‹ç®¡ç† |
| **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡** | Rails ActionCable | åŒæ–¹å‘é€šä¿¡ï¼ˆWebSocketï¼‰ |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | PostgreSQL (Neon) | ã‚²ãƒ¼ãƒ ãƒ»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ»å±¥æ­´ã®æ°¸ç¶šåŒ– |
| **ç’°å¢ƒ** | Docker + docker-compose | é–‹ç™ºç’°å¢ƒã®çµ±ä¸€ |
| **ãƒ‡ãƒ—ãƒ­ã‚¤** | Render | ç„¡æ–™æ ã§ã®é‹ç”¨ã‚’æƒ³å®š |

---

## ğŸ—ï¸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
monopory_support_app/
â”œâ”€â”€ front/                          # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Vite + React)
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ components/             # å†åˆ©ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚       â”‚   â”œâ”€â”€ button/
â”‚       â”‚   â”‚   â””â”€â”€ CopyToClipboard.tsx
â”‚       â”‚   â””â”€â”€ Modal/
â”‚       â”‚       â””â”€â”€ QrCodeModal.tsx
â”‚       â”œâ”€â”€ pages/
â”‚       â”‚   â””â”€â”€ games/
â”‚       â”‚       â”œâ”€â”€ setting/        # ãƒ•ã‚§ãƒ¼ã‚º1: åˆæœŸè¨­å®šç”»é¢
â”‚       â”‚       â”‚   â”œâ”€â”€ NewGame.tsx          # ã‚²ãƒ¼ãƒ ä½œæˆ
â”‚       â”‚       â”‚   â”œâ”€â”€ GameJoin.tsx         # ã‚²ãƒ¼ãƒ å‚åŠ 
â”‚       â”‚       â”‚   â””â”€â”€ StartSettingGame.tsx # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆ + é–‹å§‹
â”‚       â”‚       â””â”€â”€ started/        # ãƒ•ã‚§ãƒ¼ã‚º2: ã‚²ãƒ¼ãƒ å®Ÿè¡Œç”»é¢
â”‚       â”‚           â””â”€â”€ PlayScreen.tsx       # é€é‡‘ç®¡ç†ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚       â”œâ”€â”€ hooks/                  # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚       â”‚   â”œâ”€â”€ useFetchPlayers.ts  # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚       â”‚   â””â”€â”€ usePlayerCleanup.ts # é€€å‡ºå‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆâœ…å®Ÿè£…æ¸ˆã¿ï¼‰
â”‚       â”œâ”€â”€ services/               # APIé€šä¿¡
â”‚       â”œâ”€â”€ types/
â”‚       â”‚   â””â”€â”€ game.ts             # Player, GameEventå‹å®šç¾©
â”‚       â””â”€â”€ utils/
â”‚           â””â”€â”€ actionCable.ts      # ActionCableæ¥ç¶šè¨­å®š
â”‚
â””â”€â”€ back/                           # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (Rails)
    â””â”€â”€ app/
        â”œâ”€â”€ models/
        â”‚   â”œâ”€â”€ game.rb             # has_many :players, join_tokenç”Ÿæˆ
        â”‚   â”œâ”€â”€ player.rb           # belongs_to :game
        â”‚   â””â”€â”€ log.rb              # é€é‡‘å±¥æ­´ï¼ˆæœªä½¿ç”¨ï¼‰
        â”œâ”€â”€ controllers/api/
        â”‚   â”œâ”€â”€ games_controller.rb # ã‚²ãƒ¼ãƒ CRUD
        â”‚   â””â”€â”€ players_controller.rb # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼CRUD
        â””â”€â”€ channels/
            â””â”€â”€ game_channel.rb     # ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ãƒãƒ£ãƒ³ãƒãƒ«
```

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### Game (ã‚²ãƒ¼ãƒ )

| ã‚«ãƒ©ãƒ  | å‹ | èª¬æ˜ |
|--------|-----|------|
| `id` | integer | ä¸»ã‚­ãƒ¼ |
| `join_token` | string | 8æ–‡å­—ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªå‚åŠ ã‚³ãƒ¼ãƒ‰ï¼ˆbase58ï¼‰ |
| `start_money` | integer | åˆæœŸæ‰€æŒé‡‘ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 1500ï¼‰ |
| `status` | enum | `waiting`, `playing`, `finished` |

**é–¢é€£**: `has_many :players, dependent: :destroy`

### Player (ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼)

| ã‚«ãƒ©ãƒ  | å‹ | èª¬æ˜ |
|--------|-----|------|
| `id` | integer | ä¸»ã‚­ãƒ¼ |
| `game_id` | integer | å¤–éƒ¨ã‚­ãƒ¼ |
| `name` | string | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å |
| `color` | string | è­˜åˆ¥ç”¨ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹: `#FF5733`ï¼‰ |
| `is_host` | boolean | ãƒ›ã‚¹ãƒˆæ¨©é™ãƒ•ãƒ©ã‚° |
| `money` | integer | ç¾åœ¨ã®æ‰€æŒé‡‘ |

**é–¢é€£**: `belongs_to :game`

### Log (é€é‡‘å±¥æ­´) â€»ãƒ•ã‚§ãƒ¼ã‚º2ã§ä½¿ç”¨äºˆå®š

| ã‚«ãƒ©ãƒ  | å‹ | èª¬æ˜ |
|--------|-----|------|
| `id` | integer | ä¸»ã‚­ãƒ¼ |
| `game_id` | integer | å¤–éƒ¨ã‚­ãƒ¼ |
| `sender_id` | integer | é€é‡‘å…ƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ |
| `receiver_id` | integer | é€é‡‘å…ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ |
| `amount` | integer | é€é‡‘é¡ |
| `created_at` | datetime | é€é‡‘æ—¥æ™‚ |

---

## ğŸ¯ ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥å®Ÿè£…è¨ˆç”»

### âœ… ãƒ•ã‚§ãƒ¼ã‚º1: åˆæœŸè¨­å®šãƒ•ã‚§ãƒ¼ã‚ºï¼ˆãƒ­ãƒ“ãƒ¼ï¼‰

#### ç›®çš„
ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒåŒã˜ã‚²ãƒ¼ãƒ ã«å‚åŠ ã—ã€åˆæœŸçŠ¶æ…‹ã‚’å…±æœ‰ã™ã‚‹ã€‚

#### å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

**A. ã‚²ãƒ¼ãƒ ä½œæˆï¼ˆãƒ›ã‚¹ãƒˆï¼‰**
1. **ãƒ•ã‚¡ã‚¤ãƒ«**: [NewGame.tsx](front/src/pages/games/setting/NewGame.tsx)
2. **ãƒ•ãƒ­ãƒ¼**:
   - `POST /api/games` ã§ã‚²ãƒ¼ãƒ ä½œæˆ
   - `join_token` ã‚’å–å¾—
   - ãƒ›ã‚¹ãƒˆè‡ªèº«ã‚’ `POST /api/players` ã§ç™»éŒ²ï¼ˆ`is_host: true`ï¼‰
   - `localStorage` ã« `playerId` ã¨ `isHost: true` ã‚’ä¿å­˜
   - [StartSettingGame.tsx](front/src/pages/games/setting/StartSettingGame.tsx) ã¸é·ç§»

**B. ã‚²ãƒ¼ãƒ å‚åŠ ï¼ˆä¸€èˆ¬ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰**
1. **ãƒ•ã‚¡ã‚¤ãƒ«**: [GameJoin.tsx](front/src/pages/games/setting/GameJoin.tsx)
2. **ãƒ•ãƒ­ãƒ¼**:
   - URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ `join_token` ã‚’å–å¾—
   - `GET /api/games/:join_token` ã§ã‚²ãƒ¼ãƒ å­˜åœ¨ç¢ºèª
   - åå‰ãƒ»è‰²ã‚’å…¥åŠ›å¾Œã€`POST /api/players` ã§ç™»éŒ²ï¼ˆ`is_host: false`ï¼‰
   - `localStorage` ã« `playerId` ã¨ `isHost: false` ã‚’ä¿å­˜
   - [StartSettingGame.tsx](front/src/pages/games/setting/StartSettingGame.tsx) ã¸é·ç§»

**C. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆåŒæœŸ**
1. **ãƒ•ã‚¡ã‚¤ãƒ«**: [StartSettingGame.tsx](front/src/pages/games/setting/StartSettingGame.tsx)
2. **ãƒ•ãƒ­ãƒ¼**:
   - `GET /api/games/:join_token/players` ã§åˆæœŸãƒ‡ãƒ¼ã‚¿å–å¾—
   - ActionCable (`GameChannel`) ã‚’ã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒ–
   - `PLAYER_ADDED` ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡ã—ã¦ `all_players` ã§çŠ¶æ…‹æ›´æ–°
   - QRã‚³ãƒ¼ãƒ‰ãƒ»å‚åŠ ã‚³ãƒ¼ãƒ‰è¡¨ç¤º
   - ã€Œã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã€ãƒœã‚¿ãƒ³ã§ `/games/:join_token/play` ã¸é·ç§»

**D. é€€å‡ºå‡¦ç†ï¼ˆã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼‰** âœ…å®Ÿè£…æ¸ˆã¿
1. **ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯**: [usePlayerCleanup.ts](front/src/hooks/usePlayerCleanup.ts)
   - ãƒ–ãƒ©ã‚¦ã‚¶ã‚¯ãƒ­ãƒ¼ã‚ºæ™‚ã« `navigator.sendBeacon()` ã§ `DELETE /api/players/:id` ã‚’å®Ÿè¡Œ
   - `beforeunload` ã‚¤ãƒ™ãƒ³ãƒˆã§æ¤œçŸ¥
   - æ‰‹å‹•å®Ÿè¡Œç”¨ã® `cleanupPlayer()` é–¢æ•°ã‚’æä¾›ï¼ˆæˆ»ã‚‹ãƒœã‚¿ãƒ³ç”¨ï¼‰

2. **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: [players_controller.rb:26-55](back/app/controllers/api/players_controller.rb#L26-L55)
   - **ãƒ›ã‚¹ãƒˆé€€å‡º**: `game.destroy` ã§ã‚²ãƒ¼ãƒ ã”ã¨å‰Šé™¤ â†’ `GAME_DELETED` ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ
   - **ä¸€èˆ¬ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é€€å‡º**: `player.destroy` â†’ `PLAYER_REMOVED` ã‚¤ãƒ™ãƒ³ãƒˆã§æ®‹ã‚Šã®ãƒ¡ãƒ³ãƒãƒ¼ã«é€šçŸ¥

3. **å‹å®šç¾©**: [game.ts:9-14](front/src/types/game.ts#L9-L14)
   - `GameEvent` ã« `PLAYER_REMOVED`, `GAME_DELETED` ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
   - `message` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ï¼ˆå‰Šé™¤é€šçŸ¥ç”¨ï¼‰

4. **StartSettingGameçµ±åˆ**: [StartSettingGame.tsx](front/src/pages/games/setting/StartSettingGame.tsx)
   - `usePlayerCleanup` ãƒ•ãƒƒã‚¯ã‚’é©ç”¨
   - ã€Œæˆ»ã‚‹ã€ãƒœã‚¿ãƒ³ã« `handleBack` é–¢æ•°ã‚’é©ç”¨ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å‰Šé™¤ â†’ ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸é·ç§»ï¼‰
   - ActionCableã§æ–°ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡:
     - `PLAYER_REMOVED`: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã‚’æ›´æ–°
     - `GAME_DELETED`: ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º â†’ ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸å¼·åˆ¶ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

**E. localStorageæ´»ç”¨**
- âœ… ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆæ™‚ã« `playerId` ã¨ `isHost` ã‚’ä¿å­˜ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- âŒ ãƒ–ãƒ©ã‚¦ã‚¶ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã®å¾©å…ƒæ©Ÿèƒ½ï¼ˆæœªå®Ÿè£…ï¼‰

#### æœªå®Ÿè£…æ©Ÿèƒ½ï¼ˆä»•æ§˜ç­–å®šæ¸ˆã¿ï¼‰

**F. localStorageå¾©å…ƒæ©Ÿèƒ½**
- ãƒ–ãƒ©ã‚¦ã‚¶ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã« `playerId` ã¨ `isHost` ã‚’å¾©å…ƒ
- è©²å½“ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ç”»é¢ã«å¾©å¸°å¯èƒ½ã«ã™ã‚‹

---

### ğŸš§ ãƒ•ã‚§ãƒ¼ã‚º2: é€é‡‘ç®¡ç†ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆæœªå®Ÿè£…ï¼‰

#### ç›®çš„
ç´™å¹£ã®ã‚„ã‚Šå–ã‚Šã‚’ã‚¹ãƒãƒ›ã§ä»£æ›¿ã—ã€é€é‡‘ã‚„å—å–ã‚’ç°¡æ½”ã«è¡Œã†ã€‚

#### å®Ÿè£…äºˆå®šæ©Ÿèƒ½

**A. PlayScreenï¼ˆãƒ¡ã‚¤ãƒ³ç”»é¢ï¼‰**
1. **ãƒ•ã‚¡ã‚¤ãƒ«**: `front/src/pages/games/started/PlayScreen.tsx`ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã¿å­˜åœ¨ï¼‰
2. **å®Ÿè£…å†…å®¹**:
   - å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ï¿½ï¿½ã®æ‰€æŒé‡‘ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
   - é€é‡‘ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆé‡‘é¡å…¥åŠ› + å®›å…ˆé¸æŠï¼‰
   - é€é‡‘å±¥æ­´ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³

**B. é€é‡‘ãƒ­ã‚¸ãƒƒã‚¯**
1. **ãƒ›ã‚¹ãƒˆå°‚ç”¨æ©Ÿèƒ½**:
   - ã€Œè‡ªåˆ†ã€â‡”ã€ŒéŠ€è¡Œã€ã®åˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¤ãƒƒãƒ
   - éŠ€è¡Œã¨ã—ã¦é€é‡‘å¯èƒ½ï¼ˆçµ¦æ–™ãƒ»é€šéãƒœãƒ¼ãƒŠã‚¹ãªã©ï¼‰

2. **å…¨å“¡å…±é€šæ©Ÿèƒ½**:
   - é‡‘é¡å…¥åŠ›: ã‚¯ã‚¤ãƒƒã‚¯ãƒœã‚¿ãƒ³ï¼ˆÂ¥100, Â¥500, Â¥1000ï¼‰+ æ‰‹å…¥åŠ›
   - å®›å…ˆé¸æŠ: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆ + éŠ€è¡Œã‚ªãƒ—ã‚·ãƒ§ãƒ³
   - é€é‡‘å®Ÿè¡Œ: `POST /api/transactions` â†’ ActionCableã§å…¨å“¡ã«é€šçŸ¥

**C. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**
1. **æ–°è¦ãƒ¢ãƒ‡ãƒ«**: `Transaction`
   ```ruby
   # app/models/transaction.rb
   class Transaction < ApplicationRecord
     belongs_to :game
     belongs_to :sender, class_name: 'Player', optional: true # éŠ€è¡Œã®å ´åˆnull
     belongs_to :receiver, class_name: 'Player'

     validates :amount, numericality: { greater_than: 0 }
   end
   ```

2. **ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼**: `app/controllers/api/transactions_controller.rb`
   - `create` ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: é€é‡‘å‡¦ç† + æ®‹é«˜æ›´æ–° + ActionCableé€šçŸ¥

3. **GameEventå‹å®šç¾©æ›´æ–°**: [game.ts:9-13](front/src/types/game.ts#L9-L13)
   ```typescript
   export interface GameEvent {
     type: "PLAYER_ADDED" | "PLAYER_REMOVED" | "GAME_DELETED" | "MONEY_TRANSFERRED";
     player?: Player;
     all_players: Player[];
     transaction?: Transaction;
   }
   ```

---

### ğŸ¡ ãƒ•ã‚§ãƒ¼ã‚º3: ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆæ©Ÿèƒ½ï¼ˆæ§‹æƒ³æ®µéšï¼‰

- ã‚µã‚¤ã‚³ãƒ­ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆæŠ½é¸ã‚’ã‚¢ãƒ—ãƒªã§ä»£æ›¿
- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤º
- çµæœã®å…¨ä½“å…±æœ‰ï¼ˆActionCableï¼‰

---

## ğŸ”‘ é‡è¦ãªå®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ

### 1. çŠ¶æ…‹ç®¡ç†ã¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è­˜åˆ¥

| é …ç›® | å®Ÿè£…æ–¹æ³• | ç›®çš„ |
|------|----------|------|
| **è‡ªåˆ†ã®ç‰¹å®š** | `localStorage` ã« `playerId` ä¿å­˜ | ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã‚‚ã€Œè‡ªåˆ†ã€ã¨ã—ã¦å¾©å¸° |
| **ãƒ›ã‚¹ãƒˆåˆ¤å®š** | `localStorage` ã« `isHost` ä¿å­˜ | æ¨©é™åˆ¶å¾¡ï¼ˆéŠ€è¡Œæ“ä½œãªã©ï¼‰ |
| **éŠ€è¡Œã®å®šç¾©** | ç‰¹æ®Šãªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ‰±ã„ | ãƒ›ã‚¹ãƒˆã®ã¿æ“ä½œå¯ã€å…¨å“¡ãŒé€é‡‘å…ˆã¨ã—ã¦é¸æŠå¯ |

### 2. ActionCableã‚¤ãƒ™ãƒ³ãƒˆè¨­è¨ˆ

| ã‚¤ãƒ™ãƒ³ãƒˆå | ç™ºç«ã‚¿ã‚¤ãƒŸãƒ³ã‚° | ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ |
|-----------|--------------|-----------|
| `PLAYER_ADDED` | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å‚åŠ æ™‚ | `{ type, all_players }` |
| `PLAYER_REMOVED` | ä¸€èˆ¬ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é€€å‡ºæ™‚ | `{ type, all_players }` |
| `GAME_DELETED` | ãƒ›ã‚¹ãƒˆé€€å‡ºæ™‚ | `{ type, message }` |
| `MONEY_TRANSFERRED` | é€é‡‘å®Ÿè¡Œæ™‚ï¼ˆæœªå®Ÿè£…ï¼‰ | `{ type, all_players, transaction }` |

### 3. ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æˆ¦ç•¥ âœ…å®Ÿè£…æ¸ˆã¿

**å•é¡Œ**: ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¦ã‚‚ `players` ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒæ®‹ã‚Šã€ãƒªã‚¹ãƒˆã«å¹½éœŠãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹

**è§£æ±ºç­–**ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰:
1. âœ… **`usePlayerCleanup` ãƒ•ãƒƒã‚¯** ã§ç”»é¢é·ç§»ãƒ»ãƒ–ãƒ©ã‚¦ã‚¶ã‚¯ãƒ­ãƒ¼ã‚ºã‚’æ¤œçŸ¥
2. âœ… `beforeunload` ã‚¤ãƒ™ãƒ³ãƒˆã§ `navigator.sendBeacon()` ã«ã‚ˆã‚Š `DELETE /api/players/:id` ã‚’å®Ÿè¡Œ
3. âœ… Railså´ã§ã€Œãƒ›ã‚¹ãƒˆãªã‚‰ `game.destroy`ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãªã‚‰ `player.destroy`ã€ã‚’åˆ¤å®š
4. âœ… ActionCableã§å…¨å“¡ã«çŠ¶æ…‹å¤‰æ›´ã‚’é€šçŸ¥ï¼ˆ`GAME_DELETED`, `PLAYER_REMOVED`ï¼‰

---

## ğŸ“ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

### Games

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ | å®Ÿè£…çŠ¶æ³ |
|---------|------|------|---------|
| GET | `/api/games` | å…¨ã‚²ãƒ¼ãƒ å–å¾— | âœ… |
| POST | `/api/games` | ã‚²ãƒ¼ãƒ ä½œæˆ | âœ… |
| GET | `/api/games/:join_token` | ã‚²ãƒ¼ãƒ è©³ç´°å–å¾— | âœ… |
| DELETE | `/api/games/:id` | ã‚²ãƒ¼ãƒ å‰Šé™¤ | âœ… |

### Players

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ | å®Ÿè£…çŠ¶æ³ |
|---------|------|------|---------|
| GET | `/api/games/:join_token/players` | ã‚²ãƒ¼ãƒ å†…ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆ | âœ… |
| POST | `/api/players` | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ | âœ… |
| DELETE | `/api/players/:id` | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å‰Šé™¤ï¼ˆãƒ›ã‚¹ãƒˆæ™‚ã¯ã‚²ãƒ¼ãƒ å‰Šé™¤ï¼‰ | âœ… |

### Transactionsï¼ˆæœªå®Ÿè£…ï¼‰

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ | å®Ÿè£…çŠ¶æ³ |
|---------|------|------|---------|
| GET | `/api/games/:join_token/transactions` | é€é‡‘å±¥æ­´å–å¾— | âŒ |
| POST | `/api/transactions` | é€é‡‘å®Ÿè¡Œ | âŒ |

---

## ğŸ› ï¸ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆå„ªå…ˆé †ä½é †ï¼‰

### å„ªå…ˆåº¦ é«˜

1. **PlayScreenï¼ˆé€é‡‘ç”»é¢ï¼‰ã®å®Ÿè£…**
   - ãƒ•ã‚¡ã‚¤ãƒ«: `front/src/pages/games/started/PlayScreen.tsx`
   - å½¹å‰²: é€é‡‘ãƒ•ã‚©ãƒ¼ãƒ  + æ‰€æŒé‡‘è¡¨ç¤º

2. **localStorageå¾©å…ƒæ©Ÿèƒ½**
   - å½¹å‰²: ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã« `playerId` ã‹ã‚‰è‡ªå‹•å¾©å¸°

### å„ªå…ˆåº¦ ä¸­

3. **Transactionãƒ¢ãƒ‡ãƒ«ãƒ»ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ä½œæˆ**
   - å½¹å‰²: é€é‡‘ãƒ­ã‚¸ãƒƒã‚¯ + ActionCableé€šçŸ¥

4. **åˆæœŸæ‰€æŒé‡‘è¨­å®šæ©Ÿèƒ½**
   - å½¹å‰²: ãƒ›ã‚¹ãƒˆãŒé–‹å§‹å‰ã«é‡‘é¡ã‚’ä¸€æ‹¬è¨­å®š

### å„ªå…ˆåº¦ ä½

5. **ãƒ›ã‚¹ãƒˆäº¤ä»£æ©Ÿèƒ½**
   - å½¹å‰²: ç¾ãƒ›ã‚¹ãƒˆãŒæ¬¡ãƒ›ã‚¹ãƒˆã‚’æŒ‡å®š

---

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»æ³¨æ„äº‹é …

1. **CORSè¨­å®š**: Railså´ã§ `config/initializers/cors.rb` ã‚’è¨­å®šæ¸ˆã¿ã‹ç¢ºèª
2. **join_tokenã®å®‰å…¨æ€§**: 8æ–‡å­—ã®base58ã¯ååˆ†ã ãŒã€ã‚²ãƒ¼ãƒ å‰Šé™¤å¾Œã¯ãƒˆãƒ¼ã‚¯ãƒ³å†åˆ©ç”¨ä¸å¯ã«ã™ã‚‹
3. **ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å‰Šé™¤ã®èªè¨¼**: ç¾çŠ¶ã€èª°ã§ã‚‚ä»–äººã®IDã§å‰Šé™¤å¯èƒ½ â†’ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãŒå¿…è¦ï¼ˆå°†æ¥çš„ã«ï¼‰
4. **ActionCableã®æ¥ç¶šç®¡ç†**: è¤‡æ•°ã‚¿ãƒ–é–‹ã„ãŸå ´åˆã®æŒ™å‹•ã‚’è€ƒæ…®

---

## ğŸ’¡ é–‹ç™ºTips

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰èµ·å‹•ï¼ˆDockerï¼‰
cd back
docker-compose up

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èµ·å‹•
cd front
npm run dev
```

### ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰

```bash
# Railsã‚³ãƒ³ã‚½ãƒ¼ãƒ«
docker-compose exec web rails c

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
docker-compose exec web rails db:migrate

# Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ
cd front/src/pages/games/setting
touch NewComponent.tsx
```

### ãƒ‡ãƒãƒƒã‚°ãƒã‚¤ãƒ³ãƒˆ

- **ActionCableãŒç¹‹ãŒã‚‰ãªã„**: `actionCable.ts` ã®æ¥ç¶šURLã‚’ç¢ºèª
- **ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆãŒæ›´æ–°ã•ã‚Œãªã„**: ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ `GameChannel` ã®ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ã‚’ç¢ºèª
- **QRã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œãªã„**: `QrCodeModal.tsx` ã®URLç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã‚’ç¢ºèª

---

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Rails ActionCable ã‚¬ã‚¤ãƒ‰](https://guides.rubyonrails.org/action_cable_overview.html)
- [React Router v6 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://reactrouter.com/en/main)
- [TailwindCSS + DaisyUI](https://daisyui.com/)

---

**æœ€çµ‚æ›´æ–°**: 2026-01-30

**ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚º**: ãƒ•ã‚§ãƒ¼ã‚º1ï¼ˆåˆæœŸè¨­å®šï¼‰å®Œäº† âœ…
- ã‚²ãƒ¼ãƒ ä½œæˆãƒ»å‚åŠ æ©Ÿèƒ½
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆåŒæœŸ
- **é€€å‡ºå‡¦ç†ï¼ˆã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼‰å®Ÿè£…å®Œäº†** ğŸ‰
  - `usePlayerCleanup` ãƒ•ãƒƒã‚¯
  - ãƒ›ã‚¹ãƒˆé€€å‡ºæ™‚ã®ã‚²ãƒ¼ãƒ å‰Šé™¤
  - ActionCableã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥

**æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚º**: ãƒ•ã‚§ãƒ¼ã‚º2ï¼ˆé€é‡‘ç®¡ç†ï¼‰å®Ÿè£…é–‹å§‹
